(function(){function u(n,t){return Object.prototype.hasOwnProperty.call(n,t)}function i(){return 1}function n(t){if(!(this instanceof n))return new n(t);typeof t=="number"&&(t={max:t});t||(t={});this._max=t.max;this._max&&typeof this._max=="number"&&!(this._max<=0)||(this._max=Infinity);this._lengthCalculator=t.length||i;typeof this._lengthCalculator!="function"&&(this._lengthCalculator=i);this._allowStale=t.stale||!1;this._maxAge=t.maxAge||null;this._dispose=t.dispose;this.reset()}function f(n,i,r){var u=n._cache[i];return u&&(n._maxAge&&Date.now()-u.now>n._maxAge?(t(n,u),n._allowStale||(u=undefined)):r&&o(n,u),u&&(u=u.value)),u}function o(n,t){e(n,t);t.lu=n._mru++;n._lruList[t.lu]=t}function r(n){while(n._lru<n._mru&&n._length>n._max)t(n,n._lruList[n._lru])}function e(n,t){for(delete n._lruList[t.lu];n._lru<n._mru&&!n._lruList[n._lru];)n._lru++}function t(n,t){t&&(n._dispose&&n._dispose(t.key,t.value),n._length-=t.length,n._itemCount--,delete n._cache[t.key],e(n,t))}function s(n,t,i,r,u){this.key=n;this.value=t;this.lu=i;this.length=r;this.now=u}typeof module=="object"&&module.exports?module.exports=n:this.LRUCache=n;Object.defineProperty(n.prototype,"max",{set:function(n){n&&typeof n=="number"&&!(n<=0)||(n=Infinity);this._max=n;this._length>this._max&&r(this)},get:function(){return this._max},enumerable:!0});Object.defineProperty(n.prototype,"lengthCalculator",{set:function(n){var t;if(typeof n!="function"){this._lengthCalculator=i;this._length=this._itemCount;for(t in this._cache)this._cache[t].length=1}else{this._lengthCalculator=n;this._length=0;for(t in this._cache)this._cache[t].length=this._lengthCalculator(this._cache[t].value),this._length+=this._cache[t].length}this._length>this._max&&r(this)},get:function(){return this._lengthCalculator},enumerable:!0});Object.defineProperty(n.prototype,"length",{get:function(){return this._length},enumerable:!0});Object.defineProperty(n.prototype,"itemCount",{get:function(){return this._itemCount},enumerable:!0});n.prototype.forEach=function(n,i){var f,u,r;for(i=i||this,f=0,u=this._mru-1;u>=0&&f<this._itemCount;u--)this._lruList[u]&&(f++,r=this._lruList[u],this._maxAge&&Date.now()-r.now>this._maxAge&&(t(this,r),this._allowStale||(r=undefined)),r&&n.call(i,r.value,r.key,this))};n.prototype.keys=function(){for(var r,t=new Array(this._itemCount),i=0,n=this._mru-1;n>=0&&i<this._itemCount;n--)this._lruList[n]&&(r=this._lruList[n],t[i++]=r.key);return t};n.prototype.values=function(){for(var r,t=new Array(this._itemCount),i=0,n=this._mru-1;n>=0&&i<this._itemCount;n--)this._lruList[n]&&(r=this._lruList[n],t[i++]=r.value);return t};n.prototype.reset=function(){if(this._dispose&&this._cache)for(var n in this._cache)this._dispose(n,this._cache[n].value);this._cache=Object.create(null);this._lruList=Object.create(null);this._mru=0;this._lru=0;this._length=0;this._itemCount=0};n.prototype.dump=function(){return this._cache};n.prototype.dumpLru=function(){return this._lruList};n.prototype.set=function(n,t){if(u(this._cache,n))return this._dispose&&this._dispose(n,this._cache[n].value),this._maxAge&&(this._cache[n].now=Date.now()),this._cache[n].value=t,this.get(n),!0;var f=this._lengthCalculator(t),e=this._maxAge?Date.now():0,i=new s(n,t,this._mru++,f,e);return i.length>this._max?(this._dispose&&this._dispose(n,t),!1):(this._length+=i.length,this._lruList[i.lu]=this._cache[n]=i,this._itemCount++,this._length>this._max&&r(this),!0)};n.prototype.has=function(n){if(!u(this._cache,n))return!1;var t=this._cache[n];return this._maxAge&&Date.now()-t.now>this._maxAge?!1:!0};n.prototype.get=function(n){return f(this,n,!0)};n.prototype.peek=function(n){return f(this,n,!1)};n.prototype.pop=function(){var n=this._lruList[this._lru];return t(this,n),n||null};n.prototype.del=function(n){t(this,this._cache[n])}})()