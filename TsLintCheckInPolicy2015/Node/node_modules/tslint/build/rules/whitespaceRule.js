var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},OPTION_BRANCH="check-branch",OPTION_DECL="check-decl",OPTION_OPERATOR="check-operator",OPTION_SEPARATOR="check-separator",OPTION_TYPE="check-type",OPTION_TYPECAST="check-typecast",Rule=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.apply=function(n){return this.applyWithWalker(new WhitespaceWalker(n,this.getOptions()))},t.FAILURE_STRING="missing whitespace",t}(Lint.Rules.AbstractRule),WhitespaceWalker;exports.Rule=Rule;WhitespaceWalker=function(n){function t(t,i){n.call(this,t,i);this.scanner=ts.createScanner(1,!1,t.text);this.tokensToSkipStartEndMap={}}return __extends(t,n),t.prototype.visitSourceFile=function(t){var i=this,r;n.prototype.visitSourceFile.call(this,t);r=!1;this.scanner.setTextPos(0);Lint.scanAllTokens(this.scanner,function(n){var t=n.getStartPos(),u=n.getToken(),f;if(u===5||u===4?r=!1:r&&(f=i.createFailure(t,1,Rule.FAILURE_STRING),i.addFailure(f),r=!1),i.tokensToSkipStartEndMap[t]!=null){n.setTextPos(i.tokensToSkipStartEndMap[t]);return}switch(u){case 66:case 80:case 82:case 90:case 98:case 99:i.hasOption(OPTION_BRANCH)&&(r=!0);break;case 22:case 21:i.hasOption(OPTION_SEPARATOR)&&(r=!0);break;case 51:i.hasOption(OPTION_DECL)&&(r=!0);break;case 50:i.hasOption(OPTION_TYPE)&&(r=!0)}})},t.prototype.visitRegularExpressionLiteral=function(t){this.addTokenToSkipFromNode(t);n.prototype.visitRegularExpressionLiteral.call(this,t)},t.prototype.visitIdentifier=function(t){this.addTokenToSkipFromNode(t);n.prototype.visitIdentifier.call(this,t)},t.prototype.visitTemplateExpression=function(t){this.addTokenToSkipFromNode(t);n.prototype.visitTemplateExpression.call(this,t)},t.prototype.addTokenToSkipFromNode=function(n){n.getStart()<n.getEnd()&&(this.tokensToSkipStartEndMap[n.getStart()]=n.getEnd())},t.prototype.visitBinaryExpression=function(t){var r=t.operator,i;this.hasOption(OPTION_OPERATOR)&&r!==22&&(i=t.left.getEnd(),this.checkForTrailingWhitespace(i),i=t.right.getFullStart(),this.checkForTrailingWhitespace(i));n.prototype.visitBinaryExpression.call(this,t)},t.prototype.visitArrowFunction=function(t){this.checkEqualsGreaterThanTokenInNode(t);n.prototype.visitArrowFunction.call(this,t)},t.prototype.visitConstructorType=function(t){this.checkEqualsGreaterThanTokenInNode(t);n.prototype.visitConstructorType.call(this,t)},t.prototype.visitFunctionType=function(t){this.checkEqualsGreaterThanTokenInNode(t);n.prototype.visitFunctionType.call(this,t)},t.prototype.visitConditionalExpression=function(t){if(this.hasOption(OPTION_OPERATOR)){var i=t.condition.getEnd();this.checkForTrailingWhitespace(i);i=t.whenTrue.getFullStart();this.checkForTrailingWhitespace(i);i=t.whenTrue.getEnd();this.checkForTrailingWhitespace(i)}n.prototype.visitConditionalExpression.call(this,t)},t.prototype.visitVariableDeclaration=function(t){this.hasOption(OPTION_DECL)&&t.initializer!=null&&(t.type!=null?this.checkForTrailingWhitespace(t.type.getEnd()):this.checkForTrailingWhitespace(t.name.getEnd()));n.prototype.visitVariableDeclaration.call(this,t)},t.prototype.visitImportDeclaration=function(t){if(this.hasOption(OPTION_DECL)){var i=t.name.getEnd();this.checkForTrailingWhitespace(i)}n.prototype.visitImportDeclaration.call(this,t)},t.prototype.visitExportAssignment=function(t){if(this.hasOption(OPTION_DECL)){var i=t.getChildAt(0),r=i.getEnd();this.checkForTrailingWhitespace(r)}n.prototype.visitExportAssignment.call(this,t)},t.prototype.visitTypeAssertionExpression=function(t){if(this.hasOption(OPTION_TYPECAST)){var i=t.expression.getFullStart();this.checkForTrailingWhitespace(i)}n.prototype.visitTypeAssertionExpression.call(this,t)},t.prototype.checkEqualsGreaterThanTokenInNode=function(n){var i=-1,r,t;n.getChildren().forEach(function(n,t){n.kind===31&&(i=t)});i!==-1&&(r=n.getChildAt(i),this.hasOption(OPTION_OPERATOR)&&(t=r.getFullStart(),this.checkForTrailingWhitespace(t),t=r.getEnd(),this.checkForTrailingWhitespace(t)))},t.prototype.checkForTrailingWhitespace=function(n){var t,i;this.scanner.setTextPos(n);t=this.scanner.scan();t!==5&&t!==4&&t!==1&&(i=this.createFailure(n,1,Rule.FAILURE_STRING),this.addFailure(i))},t}(Lint.RuleWalker)