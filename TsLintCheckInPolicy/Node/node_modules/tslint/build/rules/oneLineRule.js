var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},OPTION_BRACE="check-open-brace",OPTION_CATCH="check-catch",OPTION_ELSE="check-else",OPTION_WHITESPACE="check-whitespace",Rule=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.apply=function(n){var t=new OneLineWalker(n,this.getOptions());return this.applyWithWalker(t)},t.BRACE_FAILURE_STRING="misplaced opening brace",t.CATCH_FAILURE_STRING="misplaced 'catch'",t.ELSE_FAILURE_STRING="misplaced 'else'",t.WHITESPACE_FAILURE_STRING="missing whitespace",t}(Lint.Rules.AbstractRule),OneLineWalker;exports.Rule=Rule;OneLineWalker=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.visitIfStatement=function(i){var e=i.getSourceFile(),f=i.thenStatement,o,s,u,r,h,c,l,a;f.kind===163&&(o=i.getChildAt(3),s=f.getChildAt(0),this.handleOpeningBrace(o,s));u=i.elseStatement;u!=null&&(r=t.getFirstChildOfKind(i,74),u.kind===163&&(h=u.getChildAt(0),this.handleOpeningBrace(r,h)),this.hasOption(OPTION_ELSE)&&(c=e.getLineAndCharacterFromPosition(f.getEnd()).line,l=e.getLineAndCharacterFromPosition(r.getStart()).line,c!==l&&(a=this.createFailure(r.getStart(),r.getWidth(),Rule.ELSE_FAILURE_STRING),this.addFailure(a))));n.prototype.visitIfStatement.call(this,i)},t.prototype.visitTryBlock=function(t){var i=t.getChildAt(0),r=t.getChildAt(1);this.handleOpeningBrace(i,r);n.prototype.visitTryBlock.call(this,t)},t.prototype.visitCatchClause=function(t){var i=t.getChildAt(0),r=t.block.getChildAt(0);this.handleOpeningBrace(i,r);n.prototype.visitCatchClause.call(this,t)},t.prototype.visitTryStatement=function(t){var r=t.getSourceFile(),u=t.catchClause,f;if(this.hasOption(OPTION_CATCH)&&u!=null){var e=t.tryBlock.getChildAt(t.tryBlock.getChildCount()-1),i=u.getChildAt(0),o=r.getLineAndCharacterFromPosition(e.getEnd()).line,s=r.getLineAndCharacterFromPosition(i.getStart()).line;o!==s&&(f=this.createFailure(i.getStart(),i.getWidth(),Rule.CATCH_FAILURE_STRING),this.addFailure(f))}n.prototype.visitTryStatement.call(this,t)},t.prototype.visitForStatement=function(t){this.handleIterationStatement(t);n.prototype.visitForStatement.call(this,t)},t.prototype.visitForInStatement=function(t){this.handleIterationStatement(t);n.prototype.visitForInStatement.call(this,t)},t.prototype.visitWhileStatement=function(t){this.handleIterationStatement(t);n.prototype.visitWhileStatement.call(this,t)},t.prototype.visitBinaryExpression=function(t){if(t.operator===51&&t.right.kind===142){var i=t.getChildAt(1),r=t.right.getChildAt(0);this.handleOpeningBrace(i,r)}n.prototype.visitBinaryExpression.call(this,t)},t.prototype.visitVariableDeclaration=function(t){var i=t.initializer,r,u;i!=null&&i.kind===142&&(r=t.getChildAt(1),u=i.getChildAt(0),this.handleOpeningBrace(r,u));n.prototype.visitVariableDeclaration.call(this,t)},t.prototype.visitDoStatement=function(t){var u=t.getChildAt(0),i=t.statement,r;i.kind===163&&(r=i.getChildAt(0),this.handleOpeningBrace(u,r));n.prototype.visitDoStatement.call(this,t)},t.prototype.visitModuleDeclaration=function(t){var u=t.name,i=t.body,r;i.kind===190&&(r=i.getChildAt(0),this.handleOpeningBrace(u,r));n.prototype.visitModuleDeclaration.call(this,t)},t.prototype.visitEnumDeclaration=function(i){var r=i.name,u=t.getFirstChildOfKind(i,13);this.handleOpeningBrace(r,u);n.prototype.visitEnumDeclaration.call(this,i)},t.prototype.visitSwitchStatement=function(t){var i=t.getChildAt(3),r=t.getChildAt(4);this.handleOpeningBrace(i,r);n.prototype.visitSwitchStatement.call(this,t)},t.prototype.visitInterfaceDeclaration=function(i){var r=i.name,u=t.getFirstChildOfKind(i,13);this.handleOpeningBrace(r,u);n.prototype.visitInterfaceDeclaration.call(this,i)},t.prototype.visitClassDeclaration=function(i){var r=i.name,u=t.getFirstChildOfKind(i,13);this.handleOpeningBrace(r,u);n.prototype.visitInterfaceDeclaration.call(this,i)},t.prototype.visitFunctionDeclaration=function(t){this.handleFunctionLikeDeclaration(t);n.prototype.visitFunctionDeclaration.call(this,t)},t.prototype.visitMethodDeclaration=function(t){this.handleFunctionLikeDeclaration(t);n.prototype.visitMethodDeclaration.call(this,t)},t.prototype.visitConstructorDeclaration=function(t){this.handleFunctionLikeDeclaration(t);n.prototype.visitConstructorDeclaration.call(this,t)},t.prototype.visitArrowFunction=function(i){var r=i.body,u,f;r!=null&&r.kind===163&&(u=t.getFirstChildOfKind(i,31),f=i.body.getChildAt(0),this.handleOpeningBrace(u,f));n.prototype.visitArrowFunction.call(this,i)},t.prototype.handleFunctionLikeDeclaration=function(n){var r=n.body,i,u;r!=null&&r.kind===163&&(i=n.body.getChildAt(0),n.type!=null?this.handleOpeningBrace(n.type,i):(u=t.getFirstChildOfKind(n,16),this.handleOpeningBrace(u,i)))},t.prototype.handleIterationStatement=function(n){var r=n.getChildAt(n.getChildCount()-2),t=n.statement,i;t.kind===163&&(i=t.getChildAt(0),this.handleOpeningBrace(r,i))},t.prototype.handleOpeningBrace=function(n,t){if(n!=null&&t!=null){var r=n.getSourceFile(),u=r.getLineAndCharacterFromPosition(n.getEnd()).line,f=r.getLineAndCharacterFromPosition(t.getStart()).line,i;this.hasOption(OPTION_BRACE)&&u!==f?i=this.createFailure(t.getStart(),t.getWidth(),Rule.BRACE_FAILURE_STRING):this.hasOption(OPTION_WHITESPACE)&&n.getEnd()===t.getStart()&&(i=this.createFailure(t.getStart(),t.getWidth(),Rule.WHITESPACE_FAILURE_STRING));i&&this.addFailure(i)}},t.getFirstChildOfKind=function(n,t){return n.getChildren().filter(function(n){return n.kind===t})[0]},t}(Lint.RuleWalker)